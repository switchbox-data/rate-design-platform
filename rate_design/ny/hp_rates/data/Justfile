# Resolve project root via git (works from any subdirectory in the repo)
project_root := `git rev-parse --show-toplevel`
path_s3_resstock_metadata := "s3://data.sb/nrel/resstock/res_2024_amy2018_2/metadata"
tariff_map_dir_ny := "{{project_root}}/rate_design/ny/hp_rates/data/tariff_map"
data_dir_ny := project_root + "/rate_design/ny/hp_rates/data"

# Fetch NY investor-owned utility customer counts from EIA-861, write to ny_electric_utility_stats.csv
fetch-ny-utility-stats:
  uv run python {{project_root}}/utils/get_utility_stats_from_eia861.py NY > {{data_dir_ny}}/ny_electric_utility_stats.csv
  @echo "Wrote {{data_dir_ny}}/ny_electric_utility_stats.csv"

# Usage: just map-electric-tariff [electric_utility] [SB_scenario_type] [SB_scenario_year] [upgrade_id] [output_dir]
# Example: just map-electric-tariff coned default 1 00 ./rate_design/ny/hp_rates/data/tariff_map
# electric_utility: std_name (e.g. coned, nyseg, nimo)
map-electric-tariff electric_utility SB_scenario_type SB_scenario_year upgrade_id output_dir:
  uv run python {{project_root}}/utils/electric_tariff_mapper.py \
    --metadata_path "{{path_s3_resstock_metadata}}" \
    --state NY \
    --upgrade_id "{{upgrade_id}}" \
    --electric_utility "{{electric_utility}}" \
    --SB_scenario_type "{{SB_scenario_type}}" \
    --SB_scenario_year "{{SB_scenario_year}}" \
    --output_dir "{{output_dir}}"

# Some useful enumerations:

map-electric-coned-default:
  just map-electric-tariff coned default 1 00 {{tariff_map_dir_ny}}

map-electric-coned-seasonal:
  just map-electric-tariff coned seasonal 1 00 {{tariff_map_dir_ny}}

map-electric-coned-class-specific-seasonal:
  just map-electric-tariff coned class_specific_seasonal 1 00 {{tariff_map_dir_ny}}

map-electric-national-grid-default:
  just map-electric-tariff nimo default 1 00 {{tariff_map_dir_ny}}

map-electric-national-grid-seasonal:
  just map-electric-tariff nimo seasonal 1 00 {{tariff_map_dir_ny}}

map-electric-national-grid-class-specific-seasonal:
  just map-electric-tariff nimo class_specific_seasonal 1 00 {{tariff_map_dir_ny}}

map-electric-nyseg-default:
  just map-electric-tariff nyseg default 1 00 {{tariff_map_dir_ny}}

map-electric-nyseg-seasonal:
  just map-electric-tariff nyseg seasonal 1 00 {{tariff_map_dir_ny}}

map-electric-nyseg-class-specific-seasonal:
  just map-electric-tariff nyseg class_specific_seasonal 1 00 {{tariff_map_dir_ny}}

# Usage: just map-gas-tariff [electric_utility] [upgrade_id] [output_dir]
# Example: just map-gas-tariff nyseg 00 ./rate_design/ny/hp_rates/data/tariff_map
map-gas-tariff electric_utility upgrade_id output_dir:
  uv run python {{project_root}}/utils/gas_tariff_mapper.py \
    --metadata_path "{{path_s3_resstock_metadata}}" \
    --state NY \
    --upgrade_id "{{upgrade_id}}" \
    --electric_utility "{{electric_utility}}" \
    --output_dir "{{output_dir}}"

# Some useful enumerations:

map-gas-coned-default:
  just map-gas-tariff coned 00 {{tariff_map_dir_ny}}

map-gas-coned-seasonal:
  just map-gas-tariff coned 00 {{tariff_map_dir_ny}}

map-gas-coned-class-specific-seasonal:
  just map-gas-tariff coned 00 {{tariff_map_dir_ny}}

map-gas-national-grid-default:
  just map-gas-tariff nimo 00 {{tariff_map_dir_ny}}

map-gas-national-grid-seasonal:
  just map-gas-tariff nimo 00 {{tariff_map_dir_ny}}

map-gas-national-grid-class-specific-seasonal:
  just map-gas-tariff nimo 00 {{tariff_map_dir_ny}}

map-gas-nyseg-default:
  just map-gas-tariff nyseg 00 {{tariff_map_dir_ny}}

map-gas-nyseg-seasonal:
  just map-gas-tariff nyseg 00 {{tariff_map_dir_ny}}

map-gas-nyseg-class-specific-seasonal:
  just map-gas-tariff nyseg 00 {{tariff_map_dir_ny}}
