# ASPE Federal Poverty Guidelines (FPL) pipeline
#
# Fetch HHS FPL from ASPE API and write to utils/post/data/fpl_guidelines.yaml.
# Used by LMI discount logic (e.g. apply_ny_lmi_discounts_to_bills, apply_ri_lmi_discounts_to_bills).
#
# Usage (from project root):
#   just -f data/aspe/fpl/Justfile fetch
#   just -f data/aspe/fpl/Justfile fetch 2020 2025

path_local_repo := `git rev-parse --show-toplevel`
path_local_fpl_yaml := path_local_repo + "/utils/post/data/fpl_guidelines.yaml"

# Fetch FPL guidelines for start_year..end_year and write to utils/post/data/fpl_guidelines.yaml
fetch start_year="2020" end_year="2025":
    uv run python "{{path_local_repo}}/data/aspe/fpl/fetch_fpl_yaml.py" \
        --start-year {{start_year}} --end-year {{end_year}} \
        --output "{{path_local_fpl_yaml}}"
